<!DOCTYPE html>
<html>
<head>
    <title>Books</title>
    <script>
        function addToCart(bookId, name, author, price, image) {
            // Get existing cart or initialize empty array
            let cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Check if item already in cart
            const exists = cart.find(item => item.id === bookId);
            if (!exists) {
                cart.push({ id: bookId, name: name, author: author, price: price, image: image });
                localStorage.setItem('cart', JSON.stringify(cart));
                alert(name + " added to cart!");
            } else {
                alert(name + " is already in the cart.");
            }
        }

        function viewCart() {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert("Your cart is empty.");
                return;
            }

            let summary = "Cart Items:\n\n";
            cart.forEach(item => {
                summary += `üìñ ${item.name} by ${item.author} - ‚Çπ${item.price}\n`;
            });
            alert(summary);
        }
    </script>
</head>
<body>
    <h2>üìö Available Books</h2>
    <button onclick="window.location.href='/cart'">üõçÔ∏è View Cart</button>
    <hr>

    {% if books %}
        {% for book in books %}
            <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                <img src="{{ book['image'] }}" width="100">
                <h3>{{ book['name'] }}</h3>
                <p><strong>Author:</strong> {{ book['author'] }}</p>
                <p><strong>Price:</strong> ‚Çπ{{ book['price'] }}</p>
                <p>{{ book['description'] }}</p>
                <p><strong>Status:</strong> {{ 'Available' if book['available'] else 'Not Available' }}</p>
                
                <button onclick="addToCart({{ book['id'] }}, '{{ book['name'] }}', '{{ book['author'] }}', {{ book['price'] }}, '{{ book['image'] }}')">
                    ‚ûï Add to Cart
                </button>

                {% if book['available'] %}
                    <form method="GET" action="/order/{{ book['id'] }}" style="margin-top:5px;">
                        <button type="submit">üõí Order Now</button>
                    </form>
                {% else %}
                    <p><em>Not available for ordering</em></p>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>No books available.</p>
    {% endif %}
</body>
</html>
